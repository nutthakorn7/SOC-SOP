# Playbook: Vulnerability Exploitation

**ID**: PB-18
**Severity**: High/Critical | **Category**: Vulnerability Management
**MITRE ATT&CK**: [T1190](https://attack.mitre.org/techniques/T1190/) (Exploit Public-Facing Application), [T1203](https://attack.mitre.org/techniques/T1203/) (Exploitation for Client Execution)
**Trigger**: IDS/IPS alert, EDR detection, vulnerability scan, TI advisory, WAF block

### Exploit Lifecycle

```mermaid
graph LR
    Disc["üîç Vuln Discovered"] --> PoC["üíª Public PoC"]
    PoC --> Wild["üåê In-the-Wild"]
    Wild --> Patch["ü©π Vendor Patch"]
    Patch --> Apply["‚úÖ Patch Applied"]
    style Disc fill:#3498db,color:#fff
    style Wild fill:#e74c3c,color:#fff
    style Apply fill:#27ae60,color:#fff
```

### Virtual Patching Flow

```mermaid
sequenceDiagram
    participant SOC
    participant WAF
    participant Dev as Dev Team
    SOC->>WAF: Create virtual patch rule
    WAF-->>SOC: ‚úÖ Rule active
    SOC->>Dev: Notify vulnerability + CVE
    Dev->>Dev: Fix source code
    Dev->>SOC: Deployed fix
    SOC->>WAF: Remove virtual patch
```

---

## Decision Flow

```mermaid
graph TD
    Alert["üö® Exploit Attempt Detected"] --> CVE["üîç Identify CVE"]
    CVE --> Vuln{"üéØ Is Target Vulnerable?"}
    Vuln -->|Patched / Not Affected| Attempt["üü° Blocked Attempt"]
    Vuln -->|Vulnerable| Response{"üìä Exploit Successful?"}
    Response -->|200 OK / Shell / Payload| Success["üî¥ Successful Exploitation"]
    Response -->|Blocked (403/Drop)| Attempt
    Response -->|Error (500)| Partial["üü† Investigate Further"]
    Attempt --> Block["üö´ Block Attacker IP"]
    Success --> Type{"üí• Exploit Impact?"}
    Type -->|RCE| RCE["üö® Isolate + Major Response"]
    Type -->|Info Disclosure| Info["üõ°Ô∏è Block + Patch"]
    Type -->|DoS| DoS["‚öôÔ∏è Mitigate + Patch"]
    Partial --> Type
    RCE --> FullIR["Full Incident Response"]
```

---

## 1. Analysis

### 1.1 CVE / Vulnerability Identification

| Check | How | Done |
|:---|:---|:---:|
| Identify CVE number from alert/signature | IPS/IDS/WAF | ‚òê |
| Check CVSS score and severity | NVD, vendor advisory | ‚òê |
| Is it in CISA KEV (Known Exploited Vulnerabilities)? | [CISA KEV](https://www.cisa.gov/known-exploited-vulnerabilities-catalog) | ‚òê |
| Is public PoC exploit available? | GitHub, ExploitDB | ‚òê |
| Check if active exploitation in the wild | TI feeds, advisories | ‚òê |

### 1.2 Target Assessment

| Check | How | Done |
|:---|:---|:---:|
| Is the target system affected? (version/config) | CMDB, vulnerability scanner | ‚òê |
| Is the vulnerable service exposed externally? | Firewall rules, Shodan | ‚òê |
| What is the asset criticality? | CMDB, business context | ‚òê |
| Is the target already patched? | Patch management system | ‚òê |
| Were compensating controls in place? (WAF, segmentation) | Security architecture | ‚òê |

### 1.3 Exploitation Evidence

| Evidence | What to Look For | Done |
|:---|:---|:---:|
| Network payload | Exploit signature in IPS/IDS logs | ‚òê |
| Server response | Success indicators (reverse shell, data leak) | ‚òê |
| Process creation | New processes spawned after exploit | ‚òê |
| File creation | Web shells, payloads dropped to disk | ‚òê |
| Outbound connections | C2 callbacks from exploited server | ‚òê |
| Post-exploitation | Credential dumping, lateral movement | ‚òê |

---

## 2. Containment

### 2.1 Exploit Attempt (Blocked)

| # | Action | Tool | Done |
|:---:|:---|:---|:---:|
| 1 | Block attacker IP | Firewall | ‚òê |
| 2 | Update IPS/WAF signatures | IPS / WAF | ‚òê |
| 3 | Alert vulnerability management to prioritize patching | Ticket | ‚òê |

### 2.2 Successful Exploitation

| # | Action | Tool | Done |
|:---:|:---|:---|:---:|
| 1 | **Isolate exploited system** immediately | EDR / Firewall | ‚òê |
| 2 | Block attacker IP and any C2 indicators | Firewall | ‚òê |
| 3 | **Apply virtual patch** at WAF/IPS | WAF / IPS | ‚òê |
| 4 | Disable vulnerable service if possible | System admin | ‚òê |
| 5 | Capture memory dump and disk image | Forensics | ‚òê |
| 6 | Check for lateral movement from exploited host | [PB-12](Lateral_Movement.en.md) | ‚òê |

### 2.3 Zero-Day (No Patch Available)

| # | Action | Done |
|:---:|:---|:---:|
| 1 | Apply workaround from vendor advisory (disable feature, config change) | ‚òê |
| 2 | Deploy custom WAF/IPS rule for exploit pattern | ‚òê |
| 3 | Segment affected systems from network | ‚òê |
| 4 | Enable enhanced monitoring / logging | ‚òê |
| 5 | Report to vendor and request emergency patch | ‚òê |

---

## 3. Eradication

| # | Action | Done |
|:---:|:---|:---:|
| 1 | **Apply official patch** from vendor | ‚òê |
| 2 | Remove any web shells, backdoors, or dropped payloads | ‚òê |
| 3 | Reset credentials on the exploited system | ‚òê |
| 4 | Scan for other vulnerable instances in environment | ‚òê |
| 5 | Check for persistence mechanisms installed by attacker | ‚òê |

---

## 4. Recovery

| # | Action | Done |
|:---:|:---|:---:|
| 1 | Run vulnerability scan to confirm patch applied | ‚òê |
| 2 | Test application functionality after patching | ‚òê |
| 3 | Reconnect system to network in stages | ‚òê |
| 4 | Monitor for re-exploitation attempts for 72 hours | ‚òê |
| 5 | Update asset inventory with patch status | ‚òê |

---

## 5. IoC Collection

| Type | Value | Source |
|:---|:---|:---|
| CVE Number | | IPS / Advisory |
| Attacker IP | | Firewall / IPS |
| Exploit Payload | | IPS / WAF logs |
| Target System | | Alert |
| Dropped Files (hash) | | EDR / Forensics |
| C2 Indicators | | Network logs |
| Post-exploitation Tools | | EDR |

---

## 6. Escalation Criteria

| Condition | Escalate To |
|:---|:---|
| RCE with confirmed shell | CISO + Major Incident |
| Zero-day (no patch available) | CISO + Vendor + CERT |
| Critical infrastructure (DB, DC) exploited | CISO immediately |
| CISA KEV vulnerability actively exploited | Vulnerability Management + SOC Lead |
| Multiple systems exploited | Major Incident |
| Data breach through exploitation | [PB-08](Data_Exfiltration.en.md) + Legal |

---

## Related Documents

- [IR Framework](../Framework.en.md)
- [Incident Report](../../templates/incident_report.en.md)
- [PB-10 Web Attack](Web_Attack.en.md)
- [PB-12 Lateral Movement](Lateral_Movement.en.md)
- [PB-13 C2 Communication](C2_Communication.en.md)

## References

- [MITRE ATT&CK T1190 ‚Äî Exploit Public-Facing Application](https://attack.mitre.org/techniques/T1190/)
- [CISA Known Exploited Vulnerabilities Catalog](https://www.cisa.gov/known-exploited-vulnerabilities-catalog)
- [NVD ‚Äî National Vulnerability Database](https://nvd.nist.gov/)
